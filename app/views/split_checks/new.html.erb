<% if hotwire_native_app? %>
<% content_for(:title) { "Dividir Cuenta" } %>
<% else %>
<% content_for(:title) { "Dividir Cuenta - Subir Ticket" } %>
<% end %>

<% content_for :head do %>
<!--  <meta name="turbo-visit-control" content="reload">-->
<% end %>

<div class="min-h-screen bg-gray-100 py-8" data-controller="split-check-upload">
  <div class="max-w-2xl mx-auto px-4">
    <% if flash[:alert] %>
      <div class="bg-red-50 border-l-4 border-red-500 p-4 mb-6 rounded-lg">
        <div class="flex items-center">
          <svg class="w-5 h-5 text-red-500 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
          <p class="text-red-700 font-medium"><%= flash[:alert] %></p>
        </div>
      </div>
    <% end %>

    <div class="bg-white rounded-xl shadow-lg p-8">
      <% unless hotwire_native_app? %><h1 class="text-3xl font-bold text-gray-800 mb-2">Dividir Cuenta</h1><% end %>
      <p class="text-gray-600 mb-8">Sube una foto de tu ticket de restaurante para dividir la cuenta</p>

      <%= form_with url: split_checks_path, method: :post, multipart: true, class: "space-y-6", data: { turbo: false, action: "submit->split-check-upload#submitForm" } do |f| %>
        <!-- Boton de Camara para Movil -->
<!--        <div data-split-check-upload-target="cameraSection" class="hidden">-->
<!--          <button type="button"-->
<!--                  data-action="click->split-check-upload#openCamera"-->
<!--                  class="w-full bg-emerald-600 text-white py-4 px-6 rounded-xl font-semibold hover:bg-emerald-700 transition-colors flex items-center justify-center gap-3">-->
<!--            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">-->
<!--              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"></path>-->
<!--              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"></path>-->
<!--            </svg>-->
<!--            Tomar Foto del Ticket-->
<!--          </button>-->
<!--          <-- Hidden file input for camera capture -->
<!--          <input type="file"-->
<!--                 data-split-check-upload-target="cameraInput"-->
<!--                 data-action="change->split-check-upload#handleCameraCapture"-->
<!--                 name="receipt_image"-->
<!--                 accept="image/*"-->
<!--                 capture="environment"-->
<!--                 class="hidden" />-->

<!--          <div class="flex items-center my-4">-->
<!--            <div class="flex-1 border-t border-gray-300"></div>-->
<!--            <span class="px-4 text-gray-500 text-sm">o subir desde galeria</span>-->
<!--            <div class="flex-1 border-t border-gray-300"></div>-->
<!--          </div>-->
<!--        </div>-->

        <div data-split-check-upload-target="dropZone"
             data-action="click->split-check-upload#openFilePicker dragenter->split-check-upload#dragEnter dragover->split-check-upload#dragOver dragleave->split-check-upload#dragLeave drop->split-check-upload#drop"
             class="border-2 border-dashed border-gray-300 rounded-xl p-8 text-center hover:border-indigo-500 transition-colors cursor-pointer">
          <div data-split-check-upload-target="uploadContent" class="space-y-4">
            <div class="flex justify-center">
              <svg class="w-16 h-16 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
              </svg>
            </div>
            <div>
              <span class="text-indigo-600 font-semibold">Clic para agregar ticket</span>
              <span data-split-check-upload-target="dragText" class="text-gray-500"> o arrastra y suelta</span>
              <%= file_field_tag :receipt_image,
                                 accept: "image/*",
                                 class: "hidden",
                                 data: {
                                   split_check_upload_target: "fileInput",
                                   action: "change->split-check-upload#handleFileSelect"
                                 } %>
            </div>
            <p class="text-sm text-gray-500">PNG, JPG, GIF hasta 4MB</p>
          </div>

          <div data-split-check-upload-target="imagePreview" class="hidden mt-6">
            <img data-split-check-upload-target="previewImg" class="max-h-20 mx-auto rounded-lg shadow" />
            <p data-split-check-upload-target="fileName" class="mt-2 text-sm text-gray-600"></p>
            <button type="button"
                    data-action="click->split-check-upload#clearImage"
                    class="mt-2 text-red-500 text-sm hover:text-red-700">Eliminar imagen</button>
          </div>
        </div>

        <button type="submit"
                data-controller="bridge--haptic"
                data-action="click->bridge--haptic#vibrate"
                data-split-check-upload-target="submitBtn"
                class="hidden w-full bg-indigo-600 text-white py-3 px-6 rounded-xl font-semibold hover:bg-indigo-700 transition-colors cursor-pointer">
          <span data-split-check-upload-target="submitText">Procesar Ticket</span>
          <span data-split-check-upload-target="submitLoading" class="hidden items-center justify-center gap-2">
            <svg class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            Procesando ticket...
          </span>
        </button>
      <% end %>
    </div>
  </div>
</div>